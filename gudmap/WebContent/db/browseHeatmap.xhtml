<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:pr="http://primefaces.org/ui" >

<!-- Styles for the HEATMAP -->


<h:body>

<ui:composition template="/WEB-INF/templates/g_template1.xhtml">
	<ui:define name="title">
		Microarray Expression Profile 
	</ui:define>
	

	
	<ui:define name="content">

	<h:form id="microarrayHeatmapForm">	
		<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
		<h:outputScript library="scripts" name="jquery-latest.pack.js"></h:outputScript>
		<h:outputScript library="scripts" name="heatmap.js"></h:outputScript>
		<h:outputStylesheet library="css" name="heatmap.css" /> 
		<h:outputStylesheet library="css" name="tabbedPane.css" /> 
		
<h:panelGrid columns="4">
	<h:panelGroup>
	    <h:outputText  value="Microarray Expression Profile for:"></h:outputText>
	    <h:outputText  value=" #{microarrayHeatmapBean.title}"></h:outputText>    
	    
	</h:panelGroup>	    
		<h:selectOneMenu value="#{microarrayHeatmapBean.selectedSample}" 
			onchange="submit()" immediate="true" valueChangeListener="#{microarrayHeatmapBean.selectedSampleChanged}" >
			<f:selectItems value="#{microarrayHeatmapBean.tabOptions}" />
		</h:selectOneMenu>

		<h:outputLink id="topGene" target="_blank" 
					value ="http://toppgene.cchmc.org/CheckInput.action?training_set=#{MasterTableBrowseBean.geneList}&amp;type=HGNC&amp;query=TOPPFUN">
			<h:graphicImage library="images/display" name="ToppFun_Button.png" width="60"/> 		
		</h:outputLink>
	<h:panelGroup>
		Palette:
		<select id="palette">
		  <option value="Default" selected="selected">Default</option>
		  <option value="RdYlGn">RdYlGn</option>
		  <option value="Spectral">Spectral</option>
		  <option value="RdYlBu">RdYlBu</option>
		  <option value="RdGy">RdGy</option>
		  <option value="RdBu">RdBu</option>
		  <option value="PiYG">PiYG</option>
		  <option value="PRGn">PRGn</option>
		  <option value="BrBG">BrBG</option>
		  <option value="PuOr">PuOr</option>
		</select>
	</h:panelGroup>	
	
	<h:outputText  value="No Data available for display" rendered="#{!microarrayHeatmapBean.dataAvailable}"></h:outputText>
 		
</h:panelGrid> 	
	
<table id="split">
<thead></thead>
<tbody></tbody>
</table>
		<h:panelGroup rendered="#{microarrayHeatmapBean.dataAvailable}">
			<div id="annotations" style='width:1100px; height:100px;'></div>	
			<div id="chart" style='overflow:auto; width:1100px; height:400px;' ></div>
		</h:panelGroup>
		
  		<h:panelGrid columns="3" columnClasses="gd_leftAlign db_navborder,gd_celltextcenter db_navborder,gd_rightAlign db_navborder" p:border="0" rendered="#{microarrayHeatmapBean.dataAvailable}">
 			<h:panelGroup>
 			  <h:panelGrid columns="5">
                <h:commandButton id="firstbutton" value="first" action="#{microarrayHeatmapBean.pageFirst}"
                    disabled="#{microarrayHeatmapBean.firstRow == 0}" >
                    <f:ajax execute="@this firstbutton" render="@form" />
                </h:commandButton>
                <h:commandButton id="prevbutton" value="prev" action="#{microarrayHeatmapBean.pagePrevious}"
                    disabled="#{microarrayHeatmapBean.firstRow == 0}" >
                    <f:ajax execute="@this prevbutton" render="@form" />
                </h:commandButton>
                <h:commandButton id="nextbutton" value="next" action="#{microarrayHeatmapBean.pageNext}"
                    disabled="#{microarrayHeatmapBean.firstRow + microarrayHeatmapBean.rowsPerPage >= microarrayHeatmapBean.totalRows}" >
                    <f:ajax execute="@this nextbutton" render="@form" />
                </h:commandButton>
                <h:commandButton id="lastbutton" value="last" action="#{microarrayHeatmapBean.pageLast}"
                    disabled="#{microarrayHeatmapBean.firstRow + microarrayHeatmapBean.rowsPerPage >= microarrayHeatmapBean.totalRows}" >
                    <f:ajax execute="@this lastbutton" render="@form" />
                </h:commandButton>
                <h:outputText value="Page #{microarrayHeatmapBean.currentPage} / #{microarrayHeatmapBean.totalPages}" />
               </h:panelGrid>
			</h:panelGroup>
			
			
			<h:panelGroup>
                <t:dataList value="#{microarrayHeatmapBean.pages}" var="page">
                    <h:commandLink class="db_pagenum" value="#{page}" actionListener="#{microarrayHeatmapBean.page}"
                        rendered="#{page != microarrayHeatmapBean.currentPage}" />
                    <h:outputText class="db_pagenum" value="&lt;b&gt;#{page}&lt;/b&gt;" escape="false"
                        rendered="#{page == microarrayHeatmapBean.currentPage}" />
                </t:dataList>
           </h:panelGroup>
           
           <h:panelGroup>
				<h:panelGrid columns="4">
	                <h:outputLabel for="rowsPerPage" value="Rows per page:&#160;&#160;" />
	                <h:inputText id="rowsPerPage" value="#{microarrayHeatmapBean.rowsPerPage}" size="3" maxlength="3" />
	                <h:commandButton id="setrowsbutton" value="Set" action="#{microarrayHeatmapBean.pageFirst}" >
	                	<f:ajax execute="@form" render="@form" />
	                </h:commandButton>               
	                <h:message for="rowsPerPage" errorStyle="color: red;" />
	             </h:panelGrid>
           </h:panelGroup>
           
         </h:panelGrid>    
		
	
	

<script type="text/javascript">
//<![CDATA[

   $(document).ready(function() {
	   
	   var tooltip = d3.select("#chart")
	   .append("div")
	   .style("position", "absolute")
	   .style("visibility", "hidden");
	   
	   var rowLabel = rowLabelArray("#{microarrayHeatmapBean.rowLabels}");	
	   var colLabel = columnLabelArray("#{microarrayHeatmapBean.columnLabels}");	   
	   var col_number = colLabel.length;

	   var geneLabels = "#{microarrayHeatmapBean.geneLabels}";
	   var geneLabel = geneLabels.split(",");
   
	   var maxcollength = "#{microarrayHeatmapBean.maxStringLength}";
	   
	   var dataarray = dataArray("#{microarrayHeatmapBean.data}");
	   var valuearray = valueDataArray("#{microarrayHeatmapBean.valueData}");
	   
	   var annotationHeaders = ["Platform","Gene","Probe Seq ID","MGI Gene ID","Entrez Gene ID","Human Ortholog Symbol","Human Ortholog Entrez","GUDMAP-ISH","UCSC","KEGG","ENS"];
	   
	   var annotationdata = annotatedDataArray("#{microarrayHeatmapBean.annotationData}");
	   var annotationdata2 = annotatedDataArray2("#{microarrayHeatmapBean.annotationData}");
	   
	   var values = "#{microarrayHeatmapBean.valueData}";
	   var adjvalues = "#{microarrayHeatmapBean.adjustedData}";
	   
	   var valuedata = valueDataArray2(values,adjvalues,col_number);
	   var cellSize=14;
	   
	   gudmap_heatmap("#chart", valuedata, annotationdata, annotationHeaders, geneLabel, colLabel, rowLabel, cellSize, tooltip);	   


			

			
 });   	
//#########################################################

//]]>
 </script>		


	</h:form>  
		<h:form id="form2" rendered="#{microarrayHeatmapBean.dataAvailable}">
			<h:outputText value="Go to page: &#160;&#160;"></h:outputText>
			<h:inputText id="gotopage" value="#{microarrayHeatmapBean.gotopage}" />
		</h:form> 

	</ui:define>
</ui:composition>
</h:body>
</html>